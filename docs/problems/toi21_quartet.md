---
title: toi21_quartet
tags: [TOI, Bruteforce, DP, Hard]
---
# [toi21_quartet](https://otog.in.th/problem/1087)

---
## Problem 

### ‡∏™‡∏£‡∏∏‡∏õ‡πÇ‡∏à‡∏ó‡∏¢‡πå
‡πÉ‡∏ô‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏ô‡∏Ñ‡∏£‡πÅ‡∏´‡πà‡∏á‡∏´‡∏ô‡∏∂‡πà‡∏á ‡∏°‡∏µ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà $3$ ‡∏ó‡∏µ‡πà ‡πÑ‡∏î‡πâ‡πÅ‡∏Å‡πà

- ‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô $N$ ‡πÅ‡∏´‡πà‡∏á ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÅ‡∏´‡πà‡∏á‡∏ñ‡∏π‡∏Å‡∏Å‡∏≥‡∏Å‡∏±‡∏ö‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà $1$ ‡∏ñ‡∏∂‡∏á $N$
- ‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏ï‡∏≥‡∏ö‡∏• $M$ ‡πÅ‡∏´‡πà‡∏á ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏ñ‡∏π‡∏Å‡∏Å‡∏≥‡∏Å‡∏±‡∏ö‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà $N+1$ ‡∏ñ‡∏∂‡∏á $N+M$
- ‡∏ñ‡∏ô‡∏ô $N+M‚àí1$ ‡∏™‡∏≤‡∏¢ ‡πÇ‡∏î‡∏¢‡∏ñ‡∏ô‡∏ô‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏°‡∏µ cycle ‡πÅ‡∏•‡∏∞ ‡∏ñ‡∏ô‡∏ô‡∏ó‡∏∏‡∏Å‡∏™‡∏≤‡∏¢‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡∏±‡∏ç‡∏à‡∏£‡∏™‡∏ß‡∏ô‡∏ó‡∏≤‡∏á‡∏Å‡∏±‡∏ô‡πÑ‡∏î‡πâ
  ‡πÇ‡∏î‡∏¢‡πÉ‡∏ô‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡πÅ‡∏´‡πà‡∏á‡∏ô‡∏µ‡πâ ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÄ‡∏£‡∏µ‡∏¢‡∏Å ‚Äú‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏≠‡∏û‡∏¢‡∏û‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‚Äù ‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏Ç‡∏≠‡∏á‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô $4$ ‡πÅ‡∏´‡πà‡∏á ‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏ï‡∏≥‡∏ö‡∏•‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ $1$ ‡∏®‡∏π‡∏ô‡∏¢‡πå ‡∏ó‡∏µ‡πà‡∏ä‡∏≤‡∏ß‡∏ö‡πâ‡∏≤‡∏ô‡∏à‡∏≤‡∏Å‡∏ó‡∏±‡πâ‡∏á $4$ ‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡∏°‡∏≤‡∏¢‡∏±‡∏á‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏ï‡∏≥‡∏ö‡∏•‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏ô‡∏±‡πâ‡∏ô‡πÑ‡∏î‡πâ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏ñ‡∏ô‡∏ô‡∏™‡∏≤‡∏¢‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô‡πÄ‡∏•‡∏¢

### ‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥
‡∏ô‡∏±‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô ‚Äú‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏≠‡∏û‡∏¢‡∏û‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‚Äù ‡πÇ‡∏î‡∏¢‡πÉ‡∏´‡πâ‡∏£‡∏∞‡∏ö‡∏∏‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Ç‡∏≠‡∏á‡πÄ‡∏®‡∏©‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏´‡∏≤‡∏£‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ç‡∏≠‡∏á ‚Äú‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏≠‡∏û‡∏¢‡∏û‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‚Äù ‡∏î‡πâ‡∏ß‡∏¢ $10^9+7$

!!! note "Constraints"
	$4 \leq N \leq 10^5$
	$1 \leq M \leq N-2$ 

!!! note "Prerequisites"
	- DFS (Depth First Search)
 	- Dynamic Programming
  	- Knapsack DP
   	- DP on Tree

### ‡∏Ç‡πâ‡∏≠‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï
‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ñ‡∏ô‡∏ô ‡∏à‡∏∞‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ö $N+M‚àí1$ ‡∏ã‡∏∂‡πà‡∏á‡∏´‡∏°‡∏≤‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ß‡πà‡∏≤ Graph ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏°‡∏≤‡∏à‡∏∞‡∏°‡∏µ‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡πÄ‡∏õ‡πá‡∏ô Tree

## Solution

### ‡πÑ‡∏≠‡πÄ‡∏î‡∏µ‡∏¢‡∏´‡∏•‡∏±‡∏Å
‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÄ‡∏Å‡πá‡∏ö‡∏ß‡πà‡∏≤ ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏ï‡∏≥‡∏ö‡∏• $u$ ‡∏ñ‡πâ‡∏≤‡πÄ‡∏£‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏´‡πâ‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô $4$ ‡πÅ‡∏´‡πà‡∏á‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡∏°‡∏≤‡∏¢‡∏±‡∏á‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏ï‡∏≥‡∏ö‡∏• $u$ ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ‡∏ñ‡∏ô‡∏ô‡∏™‡∏≤‡∏¢‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô‡πÄ‡∏•‡∏¢ ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏ô‡∏±‡∏ö‡πÑ‡∏î‡πâ‡∏Å‡∏µ‡πà‡∏Å‡∏•‡∏∏‡πà‡∏° (‡∏ô‡∏±‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏≠‡∏û‡∏¢‡∏û‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡∏°‡∏≤ $u$ ‡πÑ‡∏î‡πâ)

### ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏≥
‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏ó‡∏≥ Dynamic Programming on Tree ‡∏ö‡∏ô Tree ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏°‡∏≤ ‡πÇ‡∏î‡∏¢‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô array of vector (‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡πà‡∏≤ $cnt$) ‡∏ß‡πà‡∏≤ ‡∏ñ‡πâ‡∏≤‡πÄ‡∏£‡∏≤‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà‡πÇ‡∏´‡∏ô‡∏î $u$ ‡πÅ‡∏•‡πâ‡∏ß ‡∏´‡∏≤‡∏Å‡πÄ‡∏£‡∏≤‡πÄ‡∏î‡∏¥‡∏ô‡∏ï‡∏≤‡∏°‡∏ñ‡∏ô‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏™‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏ï‡∏¥‡∏î‡∏Å‡∏±‡∏ö‡πÇ‡∏´‡∏ô‡∏î $u$ (‡πÄ‡∏î‡∏¥‡∏ô‡∏ï‡∏≤‡∏° adjacency list) ‡πÅ‡∏•‡πâ‡∏ß ‡∏à‡∏∞‡∏°‡∏µ‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Å‡∏µ‡πà‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô‡πÉ‡∏ô‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡∏ô‡∏±‡πâ‡∏ô (‡∏ô‡∏±‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô subtree ‡∏Ç‡∏≠‡∏á $adj[u][i]$ ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ‡πÉ‡∏ô $cnt[u][i]$) ‡∏ô‡∏±‡πà‡∏ô‡∏Ñ‡∏∑‡∏≠ ‡∏Ç‡∏ô‡∏≤‡∏î‡∏Ç‡∏≠‡∏á $cnt[u]$ ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏•‡∏∞ $u$ ‡∏≠‡∏≤‡∏à‡∏à‡∏∞‡∏°‡∏µ‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏°‡πà‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ô‡∏ô‡∏±‡πà‡∏ô‡πÄ‡∏≠‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏≤‡πÑ‡∏î‡πâ $cnt$ ‡∏°‡∏≤‡πÅ‡∏•‡πâ‡∏ß ‡∏ó‡∏µ‡∏ô‡∏µ‡πâ ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏ó‡∏≥‡∏Å‡∏≤‡∏£ loop ‡∏à‡∏≤‡∏Å $N+1$ ‡∏ñ‡∏∂‡∏á $N+M$ (loop ‡πÅ‡∏Ñ‡πà‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏ï‡∏≥‡∏ö‡∏•) ‡πÅ‡∏•‡πâ‡∏ß‡∏à‡∏∞‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ß‡πà‡∏≤ ‡∏ñ‡πâ‡∏≤‡∏´‡∏≤‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏ô‡∏±‡∏ö‡∏à‡∏≤‡∏Å‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏ï‡∏≥‡∏ö‡∏•‡∏ó‡∏µ‡πà $u$ ‡πÅ‡∏•‡πâ‡∏ß ‡∏à‡∏∞‡∏°‡∏µ ‚Äú‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏≠‡∏û‡∏¢‡∏û‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‚Äù ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏Å‡∏µ‡πà‡∏Å‡∏•‡∏∏‡πà‡∏° ‡πÅ‡∏•‡∏∞‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏≤‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡∏£‡∏ö‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏ï‡∏≥‡∏ö‡∏•‡∏ó‡∏±‡πâ‡∏á $M$ ‡∏®‡∏π‡∏ô‡∏¢‡πå‡πÅ‡∏•‡πâ‡∏ß ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏≠‡∏≠‡∏Å‡∏°‡∏≤

‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì:
- ‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÅ‡∏ö‡∏ö Brute Force: ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏ó‡∏≥‡∏Å‡∏≤‡∏£ loop 4 ‡∏ä‡∏±‡πâ‡∏ô ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏∏‡∏Å‡πÜ u ‡πÇ‡∏î‡∏¢‡∏à‡∏∞ loop $i,j,k,l$ ‡πÅ‡∏•‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏∏‡∏Å‡πÜ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà loop ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡πà‡∏≤ $ans$ ‡πÑ‡∏õ‡πÄ‡∏õ‡πá‡∏ô $cnt[u][i]‚àócnt[u][j]‚àócnt[u][k]‚àócnt[u][l]$ ‡πÅ‡∏ï‡πà‡∏ß‡∏¥‡∏ò‡∏µ‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏ä‡πâ‡∏≤‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡πÉ‡∏ô‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÅ‡∏¢‡πà‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏à‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ time complexity ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì $O(n^4)$

- ‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ Dynamic Programming: ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏°‡∏µ 2d array ‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡πà‡∏≤ dp ‡πÇ‡∏î‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ:
  State ‡∏Ç‡∏≠‡∏á Dynamic Programming ‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô $dp[i][j]=$ ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô‡∏°‡∏≤ $j$ ‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô ‡∏ñ‡πâ‡∏≤‡∏´‡∏≤‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏£‡∏≤‡∏Ñ‡∏¥‡∏î‡πÅ‡∏Ñ‡πà $i$ ‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡πÅ‡∏£‡∏Å‡∏ó‡∏µ‡πà‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡∏¥‡∏î‡∏Å‡∏±‡∏ö‡πÇ‡∏´‡∏ô‡∏î $u$
  Recurrence Relation ‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô:
  - $dp[i][0]=1$ (‡∏°‡∏µ‡∏ß‡∏¥‡∏ò‡∏µ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å $0$ ‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î $1$ ‡∏ß‡∏¥‡∏ò‡∏µ ‡∏Å‡πá‡∏Ñ‡∏∑‡∏≠ ‡πÑ‡∏°‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏∞‡πÑ‡∏£‡πÄ‡∏•‡∏¢)
  - $dp[i][j]=dp[i‚àí1][j]+(dp[i‚àí1][j‚àí1]‚àócnt[u][i])$ (‡∏à‡∏∞‡∏°‡∏µ 2 ‡∏Å‡∏£‡∏ì‡∏µ‡πÑ‡∏î‡πâ‡πÅ‡∏Å‡πà: 1. ‡πÑ‡∏°‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏≤‡∏Å $adj[u][i]$ ‡πÅ‡∏•‡∏∞ 2. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏≤‡∏Å $adj[u][i]$)
  
  ‡πÅ‡∏•‡πâ‡∏ß‡∏ï‡∏≠‡∏ô‡∏à‡∏ö ‡πÄ‡∏£‡∏≤‡∏Å‡πá‡πÅ‡∏Ñ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏° $ans$ ‡πÑ‡∏õ‡∏Å‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡∏Ç‡∏≠‡∏á $dp[adj[u].size()][4]$

### Summary
‡πÉ‡∏ä‡πâ DP on Tree ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏´‡∏≤‡∏Ç‡∏ô‡∏≤‡∏î‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞ subtree ‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞ node
‡πÉ‡∏ä‡πâ DP ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô $4$ ‡πÅ‡∏´‡πà‡∏á‡∏à‡∏≤‡∏Å‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏ï‡∏≥‡∏ö‡∏•‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏®‡∏π‡∏ô‡∏¢‡πå

---

### code:

```cpp
#include <bits/stdc++.h> 

using namespace std; 

#define int long long 

const int mod = 1e9 + 7; 
const int N = 1e5 + 5; 
const int M = 1e5 + 5; 

int n, m, ans, sz[N + M]; 
vector <int> adj[N + M], cnt[N + M]; 

void dfs(int u, int p){ 
	sz[u] = (u <= n); 
	for (auto v : adj[u]) { 
		if (v == p) continue; 
		dfs(v, u); 
		if (sz[v] > 0) cnt[u].emplace_back(sz[v]), sz[u] += sz[v]; 
	} 
	cnt[u].emplace_back(n - sz[u]); 
} 

int32_t main(){ 
	cin.tie(NULL)->sync_with_stdio(false); 
	cin >> n >> m; 
	for (int i = 1; i < n + m; i++) { 
		int u, v; cin >> u >> v; 
		adj[u].emplace_back(v); 
		adj[v].emplace_back(u); 
	} 
	dfs(1, 1); 
	for (int u = n + 1; u <= n + m; u++) { 
		int siz = adj[u].size(); 
		if (siz >= 4) { 
			int dp[siz + 1][5]; 
			memset(dp, 0, sizeof dp); 
			dp[0][0] = 1; 
			for (int i = 1; i <= siz; i++) { 
				dp[i][0] = 1; 
				for (int j = 1; j <= 4; j++) { 
					dp[i][j] = dp[i - 1][j] + (dp[i - 1][j - 1] * cnt[u][i - 1]); 
				} 
			} 
			ans += dp[siz][4]; ans %= mod; 
		} 
	} 
	cout << ans; 
}
```
!!! note "Total Time Complexity"
	$O(n+m)$

‡∏´‡∏≤‡∏Å‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏™‡∏á‡∏™‡∏±‡∏¢ comment ‡πÑ‡∏ß‡πâ‡πÉ‡∏ï‡πâ post ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö üôá‚Äç‚ôÇÔ∏èüôá‚Äç‚ôÇÔ∏è
‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡πÇ‡∏à‡∏ó‡∏¢‡πå‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà Fast X Fourier
