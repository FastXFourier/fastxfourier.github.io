---
title: toi20_lover
tags: [TOI, DP, Hard]
---

# ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏≥‡∏û‡∏£‡πâ‡∏≠‡∏° code ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠  [toi20_lover](https://otog.in.th/problem/1018)

## ‡∏™‡∏£‡∏∏‡∏õ‡πÇ‡∏à‡∏ó‡∏¢‡πå

‡∏°‡∏µ $N$ ‡∏£‡πâ‡∏≤‡∏ô($N$ ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏π‡πà) ‡πÇ‡∏î‡∏¢‡∏£‡πâ‡∏≤‡∏ô‡∏ó‡∏µ‡πà $i$ ‡∏°‡∏µ‡∏£‡∏≤‡∏Ñ‡∏≤ $x_i$

‡πÇ‡∏î‡∏¢‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏ö‡πà‡∏á‡∏ä‡πà‡∏ß‡∏á‡∏Å‡∏≤‡∏£‡∏Å‡∏¥‡∏ô‡∏Ç‡πâ‡∏≤‡∏ß‡πÄ‡∏õ‡πá‡∏ô‡∏ä‡πà‡∏ß‡∏á‡πÜ ‡∏™‡∏°‡∏°‡∏ï‡∏¥‡∏ß‡πà‡∏≤‡∏°‡∏µ $M$ ‡∏ä‡πà‡∏ß‡∏á ‡πÇ‡∏î‡∏¢‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏´‡πâ $l_1+l_2+\cdots+l_M=N$ ‡πÅ‡∏•‡∏∞ $l_j$ ‡∏Ñ‡∏∑‡∏≠‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡πâ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏¥‡∏ô‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡∏Å‡∏≤‡∏£‡∏Å‡∏¥‡∏ô‡∏Ç‡πâ‡∏≤‡∏á‡∏ó‡∏µ‡πà $j$ ‡πÅ‡∏•‡∏∞ $l_j$ ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏π‡πà

‡πÇ‡∏î‡∏¢‡∏ä‡πà‡∏ß‡∏á‡∏Å‡∏≤‡∏£‡∏Å‡∏¥‡∏ô‡∏ó‡∏µ‡πà $1$ ‡∏à‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏¥‡∏ô‡∏à‡∏≤‡∏Å‡∏£‡πâ‡∏≤‡∏ô‡∏ó‡∏µ‡πà $1$ ‡πÑ‡∏õ‡∏à‡∏ô‡∏ñ‡∏∂‡∏á‡∏£‡πâ‡∏≤‡∏ô‡∏ó‡∏µ‡πà $l_1$
‡∏ä‡πà‡∏ß‡∏á‡∏Å‡∏≤‡∏£‡∏Å‡∏¥‡∏ô‡∏ó‡∏µ‡πà $2$ ‡∏à‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏¥‡∏ô‡∏à‡∏≤‡∏Å‡∏£‡πâ‡∏≤‡∏ô‡∏ó‡∏µ‡πà $l_1+1$ ‡πÑ‡∏õ‡∏à‡∏ô‡∏ñ‡∏∂‡∏á‡∏£‡πâ‡∏≤‡∏ô‡∏ó‡∏µ‡πà $l_1+l_2$
‡∏ä‡πà‡∏ß‡∏á‡∏Å‡∏≤‡∏£‡∏Å‡∏¥‡∏ô‡∏ó‡∏µ‡πà $j$ ‡∏à‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏¥‡∏ô‡∏à‡∏≤‡∏Å‡∏£‡πâ‡∏≤‡∏ô‡∏ó‡∏µ‡πà $l_1+l_2+\cdots+l_{j-1}+1$ ‡πÑ‡∏õ‡∏à‡∏ô‡∏ñ‡∏∂‡∏á‡∏£‡πâ‡∏≤‡∏ô‡∏ó‡∏µ‡πà $l_1+l_2+\cdots+l_j$

‡∏™‡∏°‡∏°‡∏ï‡∏¥‡πÉ‡∏´‡πâ‡∏ä‡πà‡∏ß‡∏á‡∏Å‡∏≤‡∏£‡∏Å‡∏¥‡∏ô‡∏ó‡∏µ‡πà $j$ ‡∏Å‡∏¥‡∏ô‡∏à‡∏≤‡∏Å‡∏£‡πâ‡∏≤‡∏ô‡∏ó‡∏µ‡πà $p$ ‡πÑ‡∏õ‡∏£‡πâ‡∏≤‡∏ô‡∏ó‡∏µ‡πà $q$ ‡πÇ‡∏î‡∏¢‡∏ä‡πà‡∏ß‡∏á‡∏Å‡∏≤‡∏£‡∏Å‡∏¥‡∏ô‡∏à‡∏∞‡πÅ‡∏ö‡πà‡∏á‡πÄ‡∏õ‡πá‡∏ô $2$ ‡∏£‡∏≠‡∏ö ‡∏£‡∏≠‡∏ö‡πÅ‡∏£‡∏Å‡∏à‡∏∞‡∏Å‡∏¥‡∏ô‡∏£‡πâ‡∏≤‡∏ô‡∏ó‡∏µ‡πà $p$ ‡∏à‡∏ô‡∏ñ‡∏∂‡∏á‡∏£‡πâ‡∏≤‡∏ô‡∏ó‡∏µ‡πà $\frac{p+q-1}{2}$ ‡πÅ‡∏•‡∏∞‡∏Å‡∏¥‡∏ô‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏£‡πâ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏µ‡πà  ‡∏£‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏™‡∏≠‡∏á‡∏à‡∏∞‡∏Å‡∏¥‡∏ô‡∏à‡∏≤‡∏Å‡∏£‡πâ‡∏≤‡∏ô‡∏ó‡∏µ‡πà $\frac{p+q-1}{2}+1$ ‡∏à‡∏ô‡∏ñ‡∏∂‡∏á‡∏£‡πâ‡∏≤‡∏ô‡∏ó‡∏µ‡πà $q$ ‡πÅ‡∏•‡∏∞‡∏Å‡∏¥‡∏ô‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏£‡πâ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏π‡πà

‡πÉ‡∏´‡πâ‡∏ú‡∏•‡∏£‡∏ß‡∏°‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏µ‡πà‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ‡∏Ç‡∏≠‡∏á‡∏£‡∏≠‡∏ö‡πÅ‡∏£‡∏Å‡∏Ç‡∏≠‡∏á‡∏ä‡πà‡∏ß‡∏á‡∏ó‡∏µ‡πà $j$ ‡πÄ‡∏õ‡πá‡∏ô $a_j$ ‡πÅ‡∏•‡∏∞‡πÉ‡∏´‡πâ‡∏ú‡∏•‡∏£‡∏ß‡∏°‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≠‡∏á‡∏£‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏™‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ‡∏Ç‡∏≠‡∏á‡∏ä‡πà‡∏ß‡∏á‡∏ó‡∏µ‡πà $j$ ‡πÄ‡∏õ‡πá‡∏ô $b_j$ ‡πÄ‡∏£‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏´‡πâ $\max(a_1,a_2,\cdots,a_M)\leq V$ ‡πÅ‡∏•‡∏∞ $\max(b_1,b_2,\cdots,b_M)\leq W$

‡πÉ‡∏´‡πâ‡∏´‡∏≤‡∏ß‡πà‡∏≤ $M$ ‡∏°‡∏µ‡∏Ñ‡πà‡∏≤‡∏ô‡πâ‡∏≠‡∏¢‡∏™‡∏∏‡∏î‡∏Ñ‡∏∑‡∏≠‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏´‡∏£‡πà

## Prerequisites
 - Dynamic Programming

## ‡∏Ç‡∏≠‡∏ö‡πÄ‡∏Ç‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
- $2 \leq N \leq 10^4$
- $1\leq V,W \leq 10^9$
- $1 \leq x_i \leq 10^4$

## ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏≥

‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡πÑ‡∏î‡πâ‡∏ß‡πà‡∏≤‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà $\max(c_1,c_2,\cdots,c_K)\leq D$ ‡πÅ‡∏õ‡∏•‡∏ß‡πà‡∏≤ $c_j \leq D$ ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏∏‡∏Å‡πÜ $1\leq j\leq K$

‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏ß‡πà‡∏≤‡∏ñ‡πâ‡∏≤‡πÉ‡∏´‡πâ $dp[n]=$ ‡∏Ñ‡πà‡∏≤ $M$ ‡∏ó‡∏µ‡πà‡∏ô‡πâ‡∏≠‡∏¢‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡πÇ‡∏î‡∏¢‡∏ó‡∏µ‡πà‡∏Ñ‡∏¥‡∏î‡πÅ‡∏Ñ‡πà $n$ ‡∏£‡πâ‡∏≤‡∏ô‡πÅ‡∏£‡∏Å ‡πÅ‡∏•‡∏∞‡∏ä‡πà‡∏ß‡∏á‡∏Å‡∏≤‡∏£‡∏Å‡∏¥‡∏ô‡∏ä‡πà‡∏ß‡∏á‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡∏à‡∏ö‡∏ó‡∏µ‡πà‡∏£‡πâ‡∏≤‡∏ô‡∏ó‡∏µ‡πà $n$ ‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡πÑ‡∏î‡πâ‡∏ß‡πà‡∏≤ $\displaystyle dp[n]=\max_{\substack{i<n,\space n-i \space \equiv \space 0 \pmod 2\\ \text{‡πÇ‡∏î‡∏¢‡∏ó‡∏µ‡πà‡∏ú‡∏•‡∏£‡∏ß‡∏°‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏µ‡πà‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ‡∏Ç‡∏≠‡∏á‡∏£‡∏≠‡∏ö‡πÅ‡∏£‡∏Å}\leq V\\ \text{‡πÇ‡∏î‡∏¢‡∏ó‡∏µ‡πà‡∏ú‡∏•‡∏£‡∏ß‡∏°‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏µ‡πà‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ‡∏Ç‡∏≠‡∏á‡∏£‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏™‡∏≠‡∏á}\leq W}}dp[i]+1$

‡∏ñ‡πâ‡∏≤‡πÄ‡∏£‡∏≤‡πÉ‡∏´‡πâ $p_{odd}[j]=$ ‡∏ú‡∏•‡∏£‡∏ß‡∏°‡∏Ç‡∏≠‡∏á‡∏ó‡∏∏‡∏Å‡πÜ ‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏µ‡πà‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏¥‡∏î‡πÅ‡∏Ñ‡πà $j$ ‡∏£‡πâ‡∏≤‡∏ô‡πÅ‡∏£‡∏Å ‡πÅ‡∏•‡∏∞ $p_{even}[j]=$ ‡∏ú‡∏•‡∏£‡∏ß‡∏°‡∏Ç‡∏≠‡∏á‡∏ó‡∏∏‡∏Å‡πÜ ‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏π‡πà‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏¥‡∏î‡πÅ‡∏Ñ‡πà $j$ ‡∏£‡πâ‡∏≤‡∏ô‡πÅ‡∏£‡∏Å

‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÉ‡∏´‡πâ $mid=\frac{n+i}{2}$

‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡∏ú‡∏•‡∏£‡∏ß‡∏°‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏µ‡πà‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ‡∏Ç‡∏≠‡∏á‡∏£‡∏≠‡∏ö‡πÅ‡∏£‡∏Å‡∏Å‡πà‡∏≠‡∏ô ‡∏ô‡∏±‡πà‡∏ô‡∏Å‡πá‡∏Ñ‡∏∑‡∏≠ $p_{odd}[mid]-p_{odd}[i]\leq V$
‡∏à‡∏≤‡∏Å‡∏ô‡∏±‡πâ‡∏ô‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡∏ú‡∏•‡∏£‡∏ß‡∏°‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏µ‡πà‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ‡∏Ç‡∏≠‡∏á‡∏£‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏™‡∏≠‡∏á ‡∏ô‡∏±‡πà‡∏ô‡∏Å‡πá‡∏Ñ‡∏∑‡∏≠ $p_{even}[n]-p_{even}[mid]\leq W$

‡∏ã‡∏∂‡πà‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏Ñ‡∏π‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡πá‡∏Ñ‡πÑ‡∏î‡πâ‡πÉ‡∏ô $O(1)$ ‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å‡πÄ‡∏£‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏ä‡πá‡∏Ñ‡∏ó‡∏∏‡∏Å‡πÜ $i<n$ ‡∏ó‡∏µ‡πà $n-i \space \equiv \space 0 \pmod 2$ ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö $dp[n]$ ‡∏ã‡∏∂‡πà‡∏á‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏ä‡πá‡∏Ñ $O(N)$ ‡∏à‡∏∏‡∏î ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏£‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥ $dp[n]$ ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏∏‡∏Å‡πÜ $n<N$ ‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏ß‡πà‡∏≤‡πÄ‡∏ß‡∏•‡∏≤‡∏£‡∏ß‡∏°‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏Ñ‡∏∑‡∏≠ $O(N^2)$


## Solution Code:

```cpp
#include <bits/stdc++.h>
using namespace std;
#define ll long long

const int inf = 1e9;

int main(){
    cin.tie(NULL)->sync_with_stdio(false);
    int n, v, w; cin >> n >> v >> w;
    vector<int> a(n + 1), p_odd(n + 1), p_even(n + 1);
    for (int i = 1; i <= n; i++) {
        cin >> a[i];
        p_odd[i] = p_odd[i - 1];
        p_even[i] = p_even[i - 1];
        if (a[i] % 2) p_odd[i] += a[i];
        else p_even[i] += a[i];
    }
    vector<int> dp(n + 1, inf); dp[0] = 0;
    for (int r = 2; r <= n; r+=2) {
        for (int l = r-2; l >= 0; l-=2) {
            int mid = (l+r)/2;
            int vs = p_odd[mid] - p_odd[l],
	            ws = p_even[r] - p_even[mid];
            if (vs <= v && ws <= w) dp[r] = min(dp[r], dp[l] + 1);
        }
    }
    cout << (dp[n] == inf ? -1 : dp[n]);
}
```

## Time Complexity: $O(N^2)$

‡∏´‡∏≤‡∏Å‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏™‡∏á‡∏™‡∏±‡∏¢ comment ‡πÑ‡∏ß‡πâ‡πÉ‡∏ï‡πâ post ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö üôá‚Äç‚ôÇÔ∏èüôá‚Äç‚ôÇÔ∏è  
‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡πÇ‡∏à‡∏ó‡∏¢‡πå‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà  [Fast X Fourier](https://fastxfourier.github.io/Home/)
